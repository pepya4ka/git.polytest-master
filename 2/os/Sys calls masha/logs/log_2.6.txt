fedor@fedor-VirtualBox:~$ cd STUDY/hook/
fedor@fedor-VirtualBox:~/STUDY/hook$ make
make -C /lib/modules/2.6.38-8-generic/build M=/home/fedor/STUDY/hook modules
make[1]: Entering directory `/usr/src/linux-headers-2.6.38-8-generic'
  CC [M]  /home/fedor/STUDY/hook/ftrace_hook.o
/home/fedor/STUDY/hook/ftrace_hook.c: In function ‘fh_ftrace_thunk’:
/home/fedor/STUDY/hook/ftrace_hook.c:73:2: error: implicit declaration of function ‘within_module’
/home/fedor/STUDY/hook/ftrace_hook.c: In function ‘fh_install_hook’:
/home/fedor/STUDY/hook/ftrace_hook.c:91:17: warning: assignment from incompatible pointer type
/home/fedor/STUDY/hook/ftrace_hook.c:92:11: error: ‘struct ftrace_ops’ has no member named ‘flags’
/home/fedor/STUDY/hook/ftrace_hook.c:92:20: error: ‘FTRACE_OPS_FL_SAVE_REGS’ undeclared (first use in this function)
/home/fedor/STUDY/hook/ftrace_hook.c:92:20: note: each undeclared identifier is reported only once for each function it appears in
/home/fedor/STUDY/hook/ftrace_hook.c:93:20: error: ‘FTRACE_OPS_FL_RECURSION_SAFE’ undeclared (first use in this function)
/home/fedor/STUDY/hook/ftrace_hook.c:94:20: error: ‘FTRACE_OPS_FL_IPMODIFY’ undeclared (first use in this function)
/home/fedor/STUDY/hook/ftrace_hook.c:96:2: error: implicit declaration of function ‘ftrace_set_filter_ip’
make[2]: *** [/home/fedor/STUDY/hook/ftrace_hook.o] Error 1
make[1]: *** [_module_/home/fedor/STUDY/hook] Error 2
make[1]: Leaving directory `/usr/src/linux-headers-2.6.38-8-generic'
make: *** [all] Error 2
fedor@fedor-VirtualBox:~/STUDY/hook$ make
make -C /lib/modules/2.6.38-8-generic/build M=/home/fedor/STUDY/hook modules
make[1]: Entering directory `/usr/src/linux-headers-2.6.38-8-generic'
  CC [M]  /home/fedor/STUDY/hook/ftrace_hook.o
/home/fedor/STUDY/hook/ftrace_hook.c: In function ‘fh_ftrace_thunk’:
/home/fedor/STUDY/hook/ftrace_hook.c:73:2: error: implicit declaration of function ‘within_module’
/home/fedor/STUDY/hook/ftrace_hook.c: In function ‘fh_install_hook’:
/home/fedor/STUDY/hook/ftrace_hook.c:91:17: warning: assignment from incompatible pointer type
/home/fedor/STUDY/hook/ftrace_hook.c:93:2: error: implicit declaration of function ‘ftrace_set_filter_ip’
make[2]: *** [/home/fedor/STUDY/hook/ftrace_hook.o] Error 1
make[1]: *** [_module_/home/fedor/STUDY/hook] Error 2
make[1]: Leaving directory `/usr/src/linux-headers-2.6.38-8-generic'
make: *** [all] Error 2
fedor@fedor-VirtualBox:~/STUDY/hook$ make
make -C /lib/modules/2.6.38-8-generic/build M=/home/fedor/STUDY/hook modules
make[1]: Entering directory `/usr/src/linux-headers-2.6.38-8-generic'
  CC [M]  /home/fedor/STUDY/hook/ftrace_hook.o
/home/fedor/STUDY/hook/ftrace_hook.c: In function ‘fh_install_hook’:
/home/fedor/STUDY/hook/ftrace_hook.c:91:17: warning: assignment from incompatible pointer type
/home/fedor/STUDY/hook/ftrace_hook.c:93:2: error: implicit declaration of function ‘ftrace_set_filter_ip’
make[2]: *** [/home/fedor/STUDY/hook/ftrace_hook.o] Error 1
make[1]: *** [_module_/home/fedor/STUDY/hook] Error 2
make[1]: Leaving directory `/usr/src/linux-headers-2.6.38-8-generic'
make: *** [all] Error 2
fedor@fedor-VirtualBox:~/STUDY/hook$ uname -r
2.6.38-8-generic
fedor@fedor-VirtualBox:~/STUDY/hook$ schedule
schedule: command not found
fedor@fedor-VirtualBox:~/STUDY/hook$ make
make -C /lib/modules/2.6.38-8-generic/build M=/home/fedor/STUDY/hook modules
make[1]: Entering directory `/usr/src/linux-headers-2.6.38-8-generic'
  CC [M]  /home/fedor/STUDY/hook/ftrace_hook.o
/home/fedor/STUDY/hook/ftrace_hook.c: In function ‘fh_install_hook’:
/home/fedor/STUDY/hook/ftrace_hook.c:91:17: warning: assignment from incompatible pointer type
/home/fedor/STUDY/hook/ftrace_hook.c:93:2: warning: passing argument 1 of ‘ftrace_set_filter’ from incompatible pointer type
include/linux/ftrace.h:170:6: note: expected ‘unsigned char *’ but argument is of type ‘struct ftrace_ops *’
/home/fedor/STUDY/hook/ftrace_hook.c:93:2: warning: passing argument 2 of ‘ftrace_set_filter’ makes integer from pointer without a cast
include/linux/ftrace.h:170:6: note: expected ‘int’ but argument is of type ‘const char *’
/home/fedor/STUDY/hook/ftrace_hook.c:93:2: error: too many arguments to function ‘ftrace_set_filter’
include/linux/ftrace.h:170:6: note: declared here
/home/fedor/STUDY/hook/ftrace_hook.c:93:6: error: void value not ignored as it ought to be
/home/fedor/STUDY/hook/ftrace_hook.c:102:3: warning: passing argument 1 of ‘ftrace_set_filter’ from incompatible pointer type
include/linux/ftrace.h:170:6: note: expected ‘unsigned char *’ but argument is of type ‘struct ftrace_ops *’
/home/fedor/STUDY/hook/ftrace_hook.c:102:3: warning: passing argument 2 of ‘ftrace_set_filter’ makes integer from pointer without a cast
include/linux/ftrace.h:170:6: note: expected ‘int’ but argument is of type ‘const char *’
/home/fedor/STUDY/hook/ftrace_hook.c:102:3: error: too many arguments to function ‘ftrace_set_filter’
include/linux/ftrace.h:170:6: note: declared here
/home/fedor/STUDY/hook/ftrace_hook.c: In function ‘fh_remove_hook’:
/home/fedor/STUDY/hook/ftrace_hook.c:122:2: error: implicit declaration of function ‘ftrace_set_filter_ip’
make[2]: *** [/home/fedor/STUDY/hook/ftrace_hook.o] Error 1
make[1]: *** [_module_/home/fedor/STUDY/hook] Error 2
make[1]: Leaving directory `/usr/src/linux-headers-2.6.38-8-generic'
make: *** [all] Error 2
fedor@fedor-VirtualBox:~/STUDY/hook$ 
fedor@fedor-VirtualBox:~/STUDY/hook$ make
make -C /lib/modules/2.6.38-8-generic/build M=/home/fedor/STUDY/hook modules
make[1]: Entering directory `/usr/src/linux-headers-2.6.38-8-generic'
  CC [M]  /home/fedor/STUDY/hook/ftrace_hook.o
/home/fedor/STUDY/hook/ftrace_hook.c: In function ‘fh_install_hook’:
/home/fedor/STUDY/hook/ftrace_hook.c:91:17: warning: assignment from incompatible pointer type
/home/fedor/STUDY/hook/ftrace_hook.c:93:6: error: void value not ignored as it ought to be
/home/fedor/STUDY/hook/ftrace_hook.c: In function ‘fh_remove_hook’:
/home/fedor/STUDY/hook/ftrace_hook.c:122:2: error: implicit declaration of function ‘ftrace_set_filter_ip’
make[2]: *** [/home/fedor/STUDY/hook/ftrace_hook.o] Error 1
make[1]: *** [_module_/home/fedor/STUDY/hook] Error 2
make[1]: Leaving directory `/usr/src/linux-headers-2.6.38-8-generic'
make: *** [all] Error 2
fedor@fedor-VirtualBox:~/STUDY/hook$ make
make -C /lib/modules/2.6.38-8-generic/build M=/home/fedor/STUDY/hook modules
make[1]: Entering directory `/usr/src/linux-headers-2.6.38-8-generic'
  CC [M]  /home/fedor/STUDY/hook/ftrace_hook.o
/home/fedor/STUDY/hook/ftrace_hook.c: In function ‘fh_install_hook’:
/home/fedor/STUDY/hook/ftrace_hook.c:91:17: warning: assignment from incompatible pointer type
/home/fedor/STUDY/hook/ftrace_hook.c:93:6: error: void value not ignored as it ought to be
/home/fedor/STUDY/hook/ftrace_hook.c: In function ‘fh_remove_hook’:
/home/fedor/STUDY/hook/ftrace_hook.c:122:6: error: void value not ignored as it ought to be
make[2]: *** [/home/fedor/STUDY/hook/ftrace_hook.o] Error 1
make[1]: *** [_module_/home/fedor/STUDY/hook] Error 2
make[1]: Leaving directory `/usr/src/linux-headers-2.6.38-8-generic'
make: *** [all] Error 2
fedor@fedor-VirtualBox:~/STUDY/hook$ make
make -C /lib/modules/2.6.38-8-generic/build M=/home/fedor/STUDY/hook modules
make[1]: Entering directory `/usr/src/linux-headers-2.6.38-8-generic'
  CC [M]  /home/fedor/STUDY/hook/ftrace_hook.o
/home/fedor/STUDY/hook/ftrace_hook.c: In function ‘fh_install_hook’:
/home/fedor/STUDY/hook/ftrace_hook.c:91:17: warning: assignment from incompatible pointer type
  Building modules, stage 2.
  MODPOST 1 modules
WARNING: "unregister_ftrace_function" [/home/fedor/STUDY/hook/ftrace_hook.ko] undefined!
WARNING: "register_ftrace_function" [/home/fedor/STUDY/hook/ftrace_hook.ko] undefined!
WARNING: "ftrace_set_filter" [/home/fedor/STUDY/hook/ftrace_hook.ko] undefined!
  CC      /home/fedor/STUDY/hook/ftrace_hook.mod.o
  LD [M]  /home/fedor/STUDY/hook/ftrace_hook.ko
make[1]: Leaving directory `/usr/src/linux-headers-2.6.38-8-generic'
fedor@fedor-VirtualBox:~/STUDY/hook$ ls -l
total 40
-rw-r--r-- 1 fedor fedor 6166 2019-04-24 20:31 ftrace_hook.c
-rw-r--r-- 1 fedor fedor 7649 2019-04-24 20:31 ftrace_hook.ko
-rw-r--r-- 1 fedor fedor  899 2019-04-24 20:31 ftrace_hook.mod.c
-rw-r--r-- 1 fedor fedor 2992 2019-04-24 20:31 ftrace_hook.mod.o
-rw-r--r-- 1 fedor fedor 6584 2019-04-24 20:31 ftrace_hook.o
-rw-r--r-- 1 fedor fedor  171 2019-04-24 18:43 Makefile
-rw-r--r-- 1 fedor fedor   45 2019-04-24 20:31 modules.order
-rw-r--r-- 1 fedor fedor    0 2019-04-24 20:31 Module.symvers
fedor@fedor-VirtualBox:~/STUDY/hook$ gedit ftrace_hook.c 
fedor@fedor-VirtualBox:~/STUDY/hook$ sudo insmod ft
ft1000     ftdi-elan  ftdi_sio   ftl        
fedor@fedor-VirtualBox:~/STUDY/hook$ sudo insmod ft
ft1000     ftdi-elan  ftdi_sio   ftl        
fedor@fedor-VirtualBox:~/STUDY/hook$ sudo insmod ftrace_hook.ko
[sudo] password for fedor: 
insmod: error inserting 'ftrace_hook.ko': -1 Unknown symbol in module
fedor@fedor-VirtualBox:~/STUDY/hook$ 
fedor@fedor-VirtualBox:~/STUDY/hook$ 
fedor@fedor-VirtualBox:~/STUDY/hook$ cat /proc/s
sched_debug    scsi/          slabinfo       stat           sys/           sysvipc/       
schedstat      self/          softirqs       swaps          sysrq-trigger  
fedor@fedor-VirtualBox:~/STUDY/hook$ cat /proc/sys/kernel/ftrace_enabled 
1
fedor@fedor-VirtualBox:~/STUDY/hook$ 
fedor@fedor-VirtualBox:~/STUDY/hook$ 
fedor@fedor-VirtualBox:~/STUDY/hook$ gedit ftrace_hook.c 
fedor@fedor-VirtualBox:~/STUDY/hook$ make clean
make -C /lib/modules/2.6.38-8-generic/build M=/home/fedor/STUDY/hook clean
make[1]: Entering directory `/usr/src/linux-headers-2.6.38-8-generic'
  CLEAN   /home/fedor/STUDY/hook/.tmp_versions
  CLEAN   /home/fedor/STUDY/hook/Module.symvers
make[1]: Leaving directory `/usr/src/linux-headers-2.6.38-8-generic'
fedor@fedor-VirtualBox:~/STUDY/hook$ ls -l
total 12
-rw-r--r-- 1 fedor fedor 6166 2019-04-24 20:42 ftrace_hook.c
-rw-r--r-- 1 fedor fedor  171 2019-04-24 18:43 Makefile
fedor@fedor-VirtualBox:~/STUDY/hook$ make
make -C /lib/modules/2.6.38-8-generic/build M=/home/fedor/STUDY/hook modules
make[1]: Entering directory `/usr/src/linux-headers-2.6.38-8-generic'
  CC [M]  /home/fedor/STUDY/hook/ftrace_hook.o
/home/fedor/STUDY/hook/ftrace_hook.c: In function ‘fh_install_hook’:
/home/fedor/STUDY/hook/ftrace_hook.c:91:17: warning: assignment from incompatible pointer type
  Building modules, stage 2.
  MODPOST 1 modules
WARNING: "unregister_ftrace_function" [/home/fedor/STUDY/hook/ftrace_hook.ko] undefined!
WARNING: "register_ftrace_function" [/home/fedor/STUDY/hook/ftrace_hook.ko] undefined!
WARNING: "ftrace_set_filter" [/home/fedor/STUDY/hook/ftrace_hook.ko] undefined!
  CC      /home/fedor/STUDY/hook/ftrace_hook.mod.o
  LD [M]  /home/fedor/STUDY/hook/ftrace_hook.ko
make[1]: Leaving directory `/usr/src/linux-headers-2.6.38-8-generic'
fedor@fedor-VirtualBox:~/STUDY/hook$ uname -r
2.6.38-8-generic
fedor@fedor-VirtualBox:~/STUDY/hook$ ls
ftrace_hook.c   ftrace_hook.mod.c  ftrace_hook.o  modules.order
ftrace_hook.ko  ftrace_hook.mod.o  Makefile       Module.symvers
fedor@fedor-VirtualBox:~/STUDY/hook$ mkdir ftrace
fedor@fedor-VirtualBox:~/STUDY/hook$ mv * ftrace
mv: cannot move `ftrace' to a subdirectory of itself, `ftrace/ftrace'
fedor@fedor-VirtualBox:~/STUDY/hook$ mv * ftrace/
mv: cannot move `ftrace' to a subdirectory of itself, `ftrace/ftrace'
fedor@fedor-VirtualBox:~/STUDY/hook$ ls
ftrace
fedor@fedor-VirtualBox:~/STUDY/hook$ cd ftrace/
fedor@fedor-VirtualBox:~/STUDY/hook/ftrace$ ls
ftrace_hook.c   ftrace_hook.mod.c  ftrace_hook.o  modules.order
ftrace_hook.ko  ftrace_hook.mod.o  Makefile       Module.symvers
fedor@fedor-VirtualBox:~/STUDY/hook/ftrace$ make clean
make -C /lib/modules/2.6.38-8-generic/build M=/home/fedor/STUDY/hook/ftrace clean
make[1]: Entering directory `/usr/src/linux-headers-2.6.38-8-generic'
  CLEAN   /home/fedor/STUDY/hook/ftrace/Module.symvers
make[1]: Leaving directory `/usr/src/linux-headers-2.6.38-8-generic'
fedor@fedor-VirtualBox:~/STUDY/hook/ftrace$ ls
ftrace_hook.c  Makefile
fedor@fedor-VirtualBox:~/STUDY/hook/ftrace$ cd ..
fedor@fedor-VirtualBox:~/STUDY/hook$ mkdir kmod
fedor@fedor-VirtualBox:~/STUDY/hook$ cd kmod/
fedor@fedor-VirtualBox:~/STUDY/hook/kmod$ ls
fedor@fedor-VirtualBox:~/STUDY/hook/kmod$ cat /proc/version
Linux version 2.6.38-8-generic (buildd@allspice) (gcc version 4.5.2 (Ubuntu/Linaro 4.5.2-8ubuntu3) ) #42-Ubuntu SMP Mon Apr 11 03:31:24 UTC 2011
fedor@fedor-VirtualBox:~/STUDY/hook/kmod$ ls -l
total 52
-rw-r--r-- 1 fedor fedor    85 2018-06-15 16:07 layout.lds
drwxr-xr-x 2 fedor fedor  4096 2018-06-15 16:07 libudis86
-rw-r--r-- 1 fedor fedor 18003 2018-06-15 16:07 LICENSE
-rw-r--r-- 1 fedor fedor   284 2018-06-15 16:07 Makefile
-rw-r--r-- 1 fedor fedor  8209 2018-06-15 16:07 module-init.c
-rw-r--r-- 1 fedor fedor  1080 2018-06-15 16:07 README.md
-rw-r--r-- 1 fedor fedor  1554 2018-06-15 16:07 udis86.h
fedor@fedor-VirtualBox:~/STUDY/hook/kmod$ cat README.md 
## About


This module provides mechanism that allows to hook kernel functions using exception tables.

## Usage

Given the kernel function `X` which has prototype `typeof(X)` let's see how to hook it:

1. Use `DECLARE_KHOOK(X)` macro to declare the hook
2. Write hook's body using `khook_X` function name and `typeof(X)` as a prototype
3. Use `KHOOK_ORIGIN(X, args)` macro as a wrapper around the `X` function call
4. Protect hook's body with `KHOOK_USAGE_INC(X)` and `KHOOK_USAGE_DEC(X)`


## Example

```
#include <linux/fs.h> // inode_permission() prototype lives here

DECLARE_KHOOK(inode_permission);
int khook_inode_permission(struct inode * inode, int mode)
{
	int result;

	KHOOK_USAGE_INC(inode_permission);

	debug("%s(%pK,%08x) [%s]\n", __func__, inode, mode, current->comm);

	result = KHOOK_ORIGIN(inode_permission, inode, mode);

	debug("%s(%pK,%08x) [%s] = %d\n", __func__, inode, mode, current->comm, result);

	KHOOK_USAGE_DEC(inode_permission);

	return result;
}
```

## Credits

Written by Ilya V. Matveychikov <matvejchikov@gmail.com>, distributed under GPL
fedor@fedor-VirtualBox:~/STUDY/hook/kmod$ gedit module-init.c 
fedor@fedor-VirtualBox:~/STUDY/hook/kmod$ make
make -C /lib/modules/2.6.38-8-generic/build M=/home/fedor/STUDY/hook/kmod
make[1]: Entering directory `/usr/src/linux-headers-2.6.38-8-generic'
  CC      /home/fedor/STUDY/hook/kmod/libudis86/decode.o
  CC      /home/fedor/STUDY/hook/kmod/libudis86/itab.o
  CC      /home/fedor/STUDY/hook/kmod/libudis86/udis86.o
  LD      /home/fedor/STUDY/hook/kmod/libudis86/built-in.o
  LD      /home/fedor/STUDY/hook/kmod/built-in.o
  CC [M]  /home/fedor/STUDY/hook/kmod/module-init.o
/home/fedor/STUDY/hook/kmod/module-init.c: In function ‘map_writable’:
/home/fedor/STUDY/hook/kmod/module-init.c:189:2: error: implicit declaration of function ‘vmap’
/home/fedor/STUDY/hook/kmod/module-init.c:189:32: error: ‘VM_MAP’ undeclared (first use in this function)
/home/fedor/STUDY/hook/kmod/module-init.c:189:32: note: each undeclared identifier is reported only once for each function it appears in
/home/fedor/STUDY/hook/kmod/module-init.c: In function ‘khook_set_priority’:
/home/fedor/STUDY/hook/kmod/module-init.c:207:2: warning: format ‘%d’ expects type ‘int’, but argument 2 has type ‘const char *’
/home/fedor/STUDY/hook/kmod/module-init.c:207:2: warning: format ‘%s’ expects type ‘char *’, but argument 5 has type ‘int’
/home/fedor/STUDY/hook/kmod/module-init.c:207:2: warning: too many arguments for format
/home/fedor/STUDY/hook/kmod/module-init.c:209:11: error: ‘setpriroity’ undeclared (first use in this function)
/home/fedor/STUDY/hook/kmod/module-init.c:209:2: warning: type defaults to ‘int’ in type name
/home/fedor/STUDY/hook/kmod/module-init.c:209:11: error: called object ‘(int *)__khook_setpriroity.origin’ is not a function
/home/fedor/STUDY/hook/kmod/module-init.c:211:2: warning: format ‘%d’ expects type ‘int’, but argument 2 has type ‘const char *’
/home/fedor/STUDY/hook/kmod/module-init.c:211:2: warning: format ‘%s’ expects type ‘char *’, but argument 5 has type ‘int’
/home/fedor/STUDY/hook/kmod/module-init.c:211:2: warning: too many arguments for format
/home/fedor/STUDY/hook/kmod/module-init.c: In function ‘cleanup_hooks’:
/home/fedor/STUDY/hook/kmod/module-init.c:350:3: error: implicit declaration of function ‘vunmap’
/home/fedor/STUDY/hook/kmod/module-init.c: At top level:
/home/fedor/STUDY/hook/kmod/module-init.c:200:1: error: ‘khook_alias_setpriroity’ aliased to undefined symbol ‘khook_setpriroity’
/home/fedor/STUDY/hook/kmod/module-init.c:200:1: error: ‘khook_alias_setpriroity’ aliased to undefined symbol ‘khook_setpriroity’
make[2]: *** [/home/fedor/STUDY/hook/kmod/module-init.o] Error 1
make[1]: *** [_module_/home/fedor/STUDY/hook/kmod] Error 2
make[1]: Leaving directory `/usr/src/linux-headers-2.6.38-8-generic'
make: *** [all] Error 2
fedor@fedor-VirtualBox:~/STUDY/hook/kmod$ gedit module-init.c 
fedor@fedor-VirtualBox:~/STUDY/hook/kmod$ make
make -C /lib/modules/2.6.38-8-generic/build M=/home/fedor/STUDY/hook/kmod
make[1]: Entering directory `/usr/src/linux-headers-2.6.38-8-generic'
  CC [M]  /home/fedor/STUDY/hook/kmod/module-init.o
/home/fedor/STUDY/hook/kmod/module-init.c: In function ‘map_writable’:
/home/fedor/STUDY/hook/kmod/module-init.c:189:2: error: implicit declaration of function ‘vmap’
/home/fedor/STUDY/hook/kmod/module-init.c:189:32: error: ‘VM_MAP’ undeclared (first use in this function)
/home/fedor/STUDY/hook/kmod/module-init.c:189:32: note: each undeclared identifier is reported only once for each function it appears in
/home/fedor/STUDY/hook/kmod/module-init.c: In function ‘khook_setpriority’:
/home/fedor/STUDY/hook/kmod/module-init.c:207:2: warning: format ‘%d’ expects type ‘int’, but argument 2 has type ‘const char *’
/home/fedor/STUDY/hook/kmod/module-init.c:207:2: warning: format ‘%s’ expects type ‘char *’, but argument 5 has type ‘int’
/home/fedor/STUDY/hook/kmod/module-init.c:207:2: warning: too many arguments for format
/home/fedor/STUDY/hook/kmod/module-init.c:209:11: error: ‘setpriroity’ undeclared (first use in this function)
/home/fedor/STUDY/hook/kmod/module-init.c:209:2: warning: type defaults to ‘int’ in type name
/home/fedor/STUDY/hook/kmod/module-init.c:209:11: error: called object ‘(int *)__khook_setpriroity.origin’ is not a function
/home/fedor/STUDY/hook/kmod/module-init.c:211:2: warning: format ‘%d’ expects type ‘int’, but argument 2 has type ‘const char *’
/home/fedor/STUDY/hook/kmod/module-init.c:211:2: warning: format ‘%s’ expects type ‘char *’, but argument 5 has type ‘int’
/home/fedor/STUDY/hook/kmod/module-init.c:211:2: warning: too many arguments for format
/home/fedor/STUDY/hook/kmod/module-init.c: In function ‘cleanup_hooks’:
/home/fedor/STUDY/hook/kmod/module-init.c:350:3: error: implicit declaration of function ‘vunmap’
/home/fedor/STUDY/hook/kmod/module-init.c: At top level:
/home/fedor/STUDY/hook/kmod/module-init.c:200:1: error: ‘khook_alias_setpriroity’ aliased to undefined symbol ‘khook_setpriroity’
/home/fedor/STUDY/hook/kmod/module-init.c:200:1: error: ‘khook_alias_setpriroity’ aliased to undefined symbol ‘khook_setpriroity’
make[2]: *** [/home/fedor/STUDY/hook/kmod/module-init.o] Error 1
make[1]: *** [_module_/home/fedor/STUDY/hook/kmod] Error 2
make[1]: Leaving directory `/usr/src/linux-headers-2.6.38-8-generic'
make: *** [all] Error 2
fedor@fedor-VirtualBox:~/STUDY/hook/kmod$ gedit module-init.c 
fedor@fedor-VirtualBox:~/STUDY/hook/kmod$ make
make -C /lib/modules/2.6.38-8-generic/build M=/home/fedor/STUDY/hook/kmod
make[1]: Entering directory `/usr/src/linux-headers-2.6.38-8-generic'
  CC [M]  /home/fedor/STUDY/hook/kmod/module-init.o
/home/fedor/STUDY/hook/kmod/module-init.c: In function ‘map_writable’:
/home/fedor/STUDY/hook/kmod/module-init.c:189:2: error: implicit declaration of function ‘vmap’
/home/fedor/STUDY/hook/kmod/module-init.c:189:32: error: ‘VM_MAP’ undeclared (first use in this function)
/home/fedor/STUDY/hook/kmod/module-init.c:189:32: note: each undeclared identifier is reported only once for each function it appears in
/home/fedor/STUDY/hook/kmod/module-init.c: In function ‘khook_setpriority’:
/home/fedor/STUDY/hook/kmod/module-init.c:205:1: error: ‘__khook_setpriroity’ undeclared (first use in this function)
/home/fedor/STUDY/hook/kmod/module-init.c:207:2: warning: format ‘%d’ expects type ‘int’, but argument 2 has type ‘const char *’
/home/fedor/STUDY/hook/kmod/module-init.c:207:2: warning: format ‘%s’ expects type ‘char *’, but argument 5 has type ‘int’
/home/fedor/STUDY/hook/kmod/module-init.c:207:2: warning: too many arguments for format
/home/fedor/STUDY/hook/kmod/module-init.c:209:11: error: ‘setpriroity’ undeclared (first use in this function)
/home/fedor/STUDY/hook/kmod/module-init.c:209:2: warning: type defaults to ‘int’ in type name
/home/fedor/STUDY/hook/kmod/module-init.c:211:2: warning: format ‘%d’ expects type ‘int’, but argument 2 has type ‘const char *’
/home/fedor/STUDY/hook/kmod/module-init.c:211:2: warning: format ‘%s’ expects type ‘char *’, but argument 5 has type ‘int’
/home/fedor/STUDY/hook/kmod/module-init.c:211:2: warning: too many arguments for format
/home/fedor/STUDY/hook/kmod/module-init.c: In function ‘cleanup_hooks’:
/home/fedor/STUDY/hook/kmod/module-init.c:350:3: error: implicit declaration of function ‘vunmap’
make[2]: *** [/home/fedor/STUDY/hook/kmod/module-init.o] Error 1
make[1]: *** [_module_/home/fedor/STUDY/hook/kmod] Error 2
make[1]: Leaving directory `/usr/src/linux-headers-2.6.38-8-generic'
make: *** [all] Error 2
fedor@fedor-VirtualBox:~/STUDY/hook/kmod$ gedit module-init.c 
fedor@fedor-VirtualBox:~/STUDY/hook/kmod$ make
make -C /lib/modules/2.6.38-8-generic/build M=/home/fedor/STUDY/hook/kmod
make[1]: Entering directory `/usr/src/linux-headers-2.6.38-8-generic'
  CC [M]  /home/fedor/STUDY/hook/kmod/module-init.o
/home/fedor/STUDY/hook/kmod/module-init.c: In function ‘map_writable’:
/home/fedor/STUDY/hook/kmod/module-init.c:189:2: error: implicit declaration of function ‘vmap’
/home/fedor/STUDY/hook/kmod/module-init.c:189:32: error: ‘VM_MAP’ undeclared (first use in this function)
/home/fedor/STUDY/hook/kmod/module-init.c:189:32: note: each undeclared identifier is reported only once for each function it appears in
/home/fedor/STUDY/hook/kmod/module-init.c: In function ‘khook_sys_setpriority’:
/home/fedor/STUDY/hook/kmod/module-init.c:205:1: error: ‘__khook_setpriroity’ undeclared (first use in this function)
/home/fedor/STUDY/hook/kmod/module-init.c:209:11: error: ‘setpriroity’ undeclared (first use in this function)
/home/fedor/STUDY/hook/kmod/module-init.c:209:2: warning: type defaults to ‘int’ in type name
/home/fedor/STUDY/hook/kmod/module-init.c: In function ‘cleanup_hooks’:
/home/fedor/STUDY/hook/kmod/module-init.c:348:3: error: implicit declaration of function ‘vunmap’
make[2]: *** [/home/fedor/STUDY/hook/kmod/module-init.o] Error 1
make[1]: *** [_module_/home/fedor/STUDY/hook/kmod] Error 2
make[1]: Leaving directory `/usr/src/linux-headers-2.6.38-8-generic'
make: *** [all] Error 2
fedor@fedor-VirtualBox:~/STUDY/hook/kmod$ gedit module-init.c 
fedor@fedor-VirtualBox:~/STUDY/hook/kmod$ make
make -C /lib/modules/2.6.38-8-generic/build M=/home/fedor/STUDY/hook/kmod
make[1]: Entering directory `/usr/src/linux-headers-2.6.38-8-generic'
  CC [M]  /home/fedor/STUDY/hook/kmod/module-init.o
/home/fedor/STUDY/hook/kmod/module-init.c: In function ‘map_writable’:
/home/fedor/STUDY/hook/kmod/module-init.c:189:2: error: implicit declaration of function ‘vmap’
/home/fedor/STUDY/hook/kmod/module-init.c:189:32: error: ‘VM_MAP’ undeclared (first use in this function)
/home/fedor/STUDY/hook/kmod/module-init.c:189:32: note: each undeclared identifier is reported only once for each function it appears in
/home/fedor/STUDY/hook/kmod/module-init.c: In function ‘khook_setpriority’:
/home/fedor/STUDY/hook/kmod/module-init.c:209:11: error: ‘setpriority’ undeclared (first use in this function)
/home/fedor/STUDY/hook/kmod/module-init.c:209:2: warning: type defaults to ‘int’ in type name
/home/fedor/STUDY/hook/kmod/module-init.c:209:11: error: called object ‘(int *)__khook_setpriority.origin’ is not a function
/home/fedor/STUDY/hook/kmod/module-init.c: In function ‘cleanup_hooks’:
/home/fedor/STUDY/hook/kmod/module-init.c:348:3: error: implicit declaration of function ‘vunmap’
make[2]: *** [/home/fedor/STUDY/hook/kmod/module-init.o] Error 1
make[1]: *** [_module_/home/fedor/STUDY/hook/kmod] Error 2
make[1]: Leaving directory `/usr/src/linux-headers-2.6.38-8-generic'
make: *** [all] Error 2
fedor@fedor-VirtualBox:~/STUDY/hook/kmod$ gedit module-init.c 
[  107.431482] Checking if this processor honours the WP bit even in supervisor mode...Ok.
[  107.431878] SLUB: Genslabs=15, HWalign=64, Order=0-3, MinObjects=0, CPUs=4, Nodes=1
[  107.431906] Hierarchical RCU implementation.
[  107.431909] 	RCU dyntick-idle grace-period acceleration is enabled.
[  107.431913] 	RCU-based detection of stalled CPUs is disabled.
[  107.431921] NR_IRQS:2304 nr_irqs:712 16
[  107.432307] CPU 0 irqstacks, hard=f2c08000 soft=f2c0a000
[  107.432501] vt handoff: transparent VT on vt#7
[  107.432512] Console: colour dummy device 80x25
[  107.432581] console [tty0] enabled
[  107.432639] Detected 3502.656 MHz processor.
[  107.432644] Calibrating delay loop (skipped) preset value.. 7005.31 BogoMIPS (lpj=14010624)
[  107.432650] pid_max: default: 32768 minimum: 301
[  107.432680] Security Framework initialized
[  107.432698] AppArmor: AppArmor initialized
[  107.432700] Yama: becoming mindful.
[  107.432771] Mount-cache hash table entries: 512
[  107.432894] Initializing cgroup subsys ns
[  107.432898] ns_cgroup deprecated: consider using the 'clone_children' flag without the ns_cgroup.
[  107.432903] Initializing cgroup subsys cpuacct
[  107.432911] Initializing cgroup subsys memory
[  107.432920] Initializing cgroup subsys devices
[  107.432924] Initializing cgroup subsys freezer
[  107.432927] Initializing cgroup subsys net_cls
[  107.432931] Initializing cgroup subsys blkio
[  107.433011] CPU: Physical Processor ID: 0
[  107.433014] CPU: Processor Core ID: 0
[  107.433031] mce: CPU supports 0 MCE banks
[  107.442952] ACPI: Core revision 20110112
[  107.445004] ftrace: allocating 23640 entries in 47 pages
[  107.477873] Enabling APIC mode:  Flat.  Using 1 I/O APICs
[  107.479764] ..TIMER: vector=0x30 apic1=0 pin1=2 apic2=-1 pin2=-1
[  107.479767] CPU0: Intel(R) Core(TM) i7-2600K CPU @ 3.40GHz stepping 07
[  107.585249] Performance Events: unsupported p6 CPU model 42 no PMU driver, software events only.
[  107.586113] CPU 1 irqstacks, hard=f2cac000 soft=f2cae000
[  107.586116] Booting Node   0, Processors  #1
[  107.596200] Initializing CPU#1
[  107.597409] mce: CPU supports 0 MCE banks
[  107.620324] kvm-clock: cpu 1, msr 0:34506841, secondary cpu clock
[  107.620373] CPU 2 irqstacks, hard=f2cc0000 soft=f2cc2000
[  107.620376]  #2
[  107.630457] Initializing CPU#2
[  107.631652] mce: CPU supports 0 MCE banks
[  107.651768] kvm-clock: cpu 2, msr 0:34606841, secondary cpu clock
[  107.651841] CPU 3 irqstacks, hard=f2cea000 soft=f2cf0000
[  107.651844]  #3 Ok.
[  107.661931] Initializing CPU#3
[  107.663131] mce: CPU supports 0 MCE banks
[  107.683242] Brought up 4 CPUs
[  107.683245] Total of 4 processors activated (28021.24 BogoMIPS).
[  107.683253] kvm-clock: cpu 3, msr 0:34706841, secondary cpu clock
[  107.684088] devtmpfs: initialized
[  107.686161] print_constraints: dummy: 
[  107.686198] Time: 22:07:35  Date: 04/24/19
[  107.686234] NET: Registered protocol family 16
[  107.686389] Trying to unpack rootfs image as initramfs...
[  107.698495] EISA bus registered
[  107.698504] ACPI: bus type pci registered
[  107.698650] PCI: PCI BIOS revision 2.10 entry at 0xfda26, last bus=0
[  107.698653] PCI: Using configuration type 1 for base access
[  107.702877] bio: create slab <bio-0> at 0
[  107.704721] ACPI: EC: Look up EC in DSDT
[  107.705406] ACPI: Executed 1 blocks of module-level executable AML code
[  107.709765] ACPI: Interpreter enabled
[  107.709770] ACPI: (supports S0 S5)
[  107.709782] ACPI: Using IOAPIC for interrupt routing
[  107.727748] ACPI: No dock devices found.
[  107.727751] HEST: Table not found.
[  107.727755] PCI: Ignoring host bridge windows from ACPI; if necessary, use "pci=use_crs" and report a bug
[  107.727861] ACPI: PCI Root Bridge [PCI0] (domain 0000 [bus 00-ff])
[  107.728056] pci_root PNP0A03:00: host bridge window [io  0x0000-0x0cf7] (ignored)
[  107.728060] pci_root PNP0A03:00: host bridge window [io  0x0d00-0xffff] (ignored)
[  107.728064] pci_root PNP0A03:00: host bridge window [mem 0x000a0000-0x000bffff] (ignored)
[  107.728069] pci_root PNP0A03:00: host bridge window [mem 0xe0000000-0xfdffffff] (ignored)
[  107.728119] pci 0000:00:00.0: [8086:1237] type 0 class 0x000600
[  107.728556] pci 0000:00:01.0: [8086:7000] type 0 class 0x000601
[  107.729221] pci 0000:00:01.1: [8086:7111] type 0 class 0x000101
[  107.729683] pci 0000:00:01.1: reg 20: [io  0xd000-0xd00f]
[  107.729999] pci 0000:00:02.0: [80ee:beef] type 0 class 0x000300
[  107.733418] pci 0000:00:02.0: reg 10: [mem 0xe0000000-0xe7ffffff pref]
[  107.778752] pci 0000:00:03.0: [8086:100e] type 0 class 0x000200
[  107.780699] pci 0000:00:03.0: reg 10: [mem 0xf0000000-0xf001ffff]
[  107.784392] pci 0000:00:03.0: reg 18: [io  0xd010-0xd017]
[  107.802018] pci 0000:00:04.0: [80ee:cafe] type 0 class 0x000880
[  107.803786] pci 0000:00:04.0: reg 10: [io  0xd020-0xd03f]
[  107.805613] pci 0000:00:04.0: reg 14: [mem 0xf0400000-0xf07fffff]
[  107.807459] pci 0000:00:04.0: reg 18: [mem 0xf0800000-0xf0803fff pref]
[  107.826120] pci 0000:00:05.0: [8086:2415] type 0 class 0x000401
[  107.829258] pci 0000:00:05.0: reg 10: [io  0xd100-0xd1ff]
[  107.829376] pci 0000:00:05.0: reg 14: [io  0xd200-0xd23f]
[  107.829966] pci 0000:00:06.0: [106b:003f] type 0 class 0x000c03
[  107.831685] pci 0000:00:06.0: reg 10: [mem 0xf0804000-0xf0804fff]
[  107.854655] pci 0000:00:07.0: [8086:7113] type 0 class 0x000680
[  107.855269] pci 0000:00:07.0: quirk: [io  0x4000-0x403f] claimed by PIIX4 ACPI
[  107.855284] pci 0000:00:07.0: quirk: [io  0x4100-0x410f] claimed by PIIX4 SMB
[  107.855530] pci 0000:00:0d.0: [8086:2829] type 0 class 0x000106
[  107.857381] pci 0000:00:0d.0: reg 10: [io  0xd240-0xd247]
[  107.859321] pci 0000:00:0d.0: reg 14: [io  0xd248-0xd24b]
[  107.861172] pci 0000:00:0d.0: reg 18: [io  0xd250-0xd257]
[  107.863031] pci 0000:00:0d.0: reg 1c: [io  0xd258-0xd25b]
[  107.864882] pci 0000:00:0d.0: reg 20: [io  0xd260-0xd26f]
[  107.866761] pci 0000:00:0d.0: reg 24: [mem 0xf0806000-0xf0807fff]
[  107.891099] pci_bus 0000:00: on NUMA node 0
[  107.891113] ACPI: PCI Interrupt Routing Table [\_SB_.PCI0._PRT]
[  107.930068] ACPI: PCI Interrupt Link [LNKA] (IRQs 5 9 10 *11)
[  107.930381] ACPI: PCI Interrupt Link [LNKB] (IRQs 5 9 *10 11)
[  107.930469] ACPI: PCI Interrupt Link [LNKC] (IRQs 5 *9 10 11)
[  107.930623] ACPI: PCI Interrupt Link [LNKD] (IRQs 5 9 10 *11)
[  107.930751] vgaarb: device added: PCI:0000:00:02.0,decodes=io+mem,owns=io+mem,locks=none
[  107.930758] vgaarb: loaded
[  107.930969] SCSI subsystem initialized
[  107.942648] libata version 3.00 loaded.
[  107.942698] usbcore: registered new interface driver usbfs
[  107.942713] usbcore: registered new interface driver hub
[  107.943038] usbcore: registered new device driver usb
[  107.943483] wmi: Mapper loaded
[  107.943485] PCI: Using ACPI for IRQ routing
[  107.943488] PCI: pci_cache_line_size set to 64 bytes
[  107.943735] reserve RAM buffer: 000000000009fc00 - 000000000009ffff 
[  107.943738] reserve RAM buffer: 00000000dfff0000 - 00000000dfffffff 
[  107.943846] NetLabel: Initializing
[  107.943848] NetLabel:  domain hash size = 128
[  107.943850] NetLabel:  protocols = UNLABELED CIPSOv4
[  107.943861] NetLabel:  unlabeled traffic allowed by default
[  107.943906] Switching to clocksource kvm-clock
[  107.944853] Switched to NOHz mode on CPU #0
[  107.947167] Switched to NOHz mode on CPU #3
[  107.947792] Switched to NOHz mode on CPU #2
[  107.948704] Switched to NOHz mode on CPU #1
[  107.952462] AppArmor: AppArmor Filesystem Enabled
[  107.952481] pnp: PnP ACPI init
[  107.952499] ACPI: bus type pnp registered
[  107.952606] pnp 00:00: [bus 00-ff]
[  107.952609] pnp 00:00: [io  0x0cf8-0x0cff]
[  107.952613] pnp 00:00: [io  0x0000-0x0cf7 window]
[  107.952616] pnp 00:00: [io  0x0d00-0xffff window]
[  107.952620] pnp 00:00: [mem 0x000a0000-0x000bffff window]
[  107.952624] pnp 00:00: [mem 0xe0000000-0xfdffffff window]
[  107.952658] pnp 00:00: Plug and Play ACPI device, IDs PNP0a03 (active)
[  107.952677] pnp 00:01: [io  0x0060]
[  107.952680] pnp 00:01: [io  0x0064]
[  107.952707] pnp 00:01: [irq 1]
[  107.952737] pnp 00:01: Plug and Play ACPI device, IDs PNP0303 (active)
[  107.952748] pnp 00:02: [io  0x0000-0x000f]
[  107.952751] pnp 00:02: [io  0x0080-0x008f]
[  107.952755] pnp 00:02: [io  0x00c0-0x00df]
[  107.952758] pnp 00:02: [dma 4]
[  107.953112] pnp 00:02: Plug and Play ACPI device, IDs PNP0200 (active)
[  107.953179] pnp 00:03: [irq 12]
[  107.953208] pnp 00:03: Plug and Play ACPI device, IDs PNP0f03 (active)
[  107.954022] pnp: PnP ACPI: found 4 devices
[  107.954026] ACPI: ACPI bus type pnp unregistered
[  107.954030] PnPBIOS: Disabled
[  107.990909] pci_bus 0000:00: resource 0 [io  0x0000-0xffff]
[  107.990914] pci_bus 0000:00: resource 1 [mem 0x00000000-0xffffffff]
[  107.990951] NET: Registered protocol family 2
[  107.991832] IP route cache hash table entries: 32768 (order: 5, 131072 bytes)
[  107.992226] TCP established hash table entries: 131072 (order: 8, 1048576 bytes)
[  107.992726] TCP bind hash table entries: 65536 (order: 7, 524288 bytes)
[  107.992967] TCP: Hash tables configured (established 131072 bind 65536)
[  107.993081] TCP reno registered
[  107.993084] UDP hash table entries: 512 (order: 2, 16384 bytes)
[  107.993092] UDP-Lite hash table entries: 512 (order: 2, 16384 bytes)
[  107.993167] NET: Registered protocol family 1
[  107.993178] pci 0000:00:00.0: Limiting direct PCI/PCI transfers
[  107.993211] pci 0000:00:01.0: Activating ISA DMA hang workarounds
[  107.993249] pci 0000:00:02.0: Boot video device
[  107.993408] PCI: CLS 0 bytes, default 64
[  107.993473] platform rtc_cmos: registered platform RTC device (no PNP device found)
[  107.993900] cpufreq-nforce2: No nForce2 chipset.
[  107.994377] audit: initializing netlink socket (disabled)
[  107.994384] type=2000 audit(1556143760.368:1): initialized
[  108.010269] highmem bounce pool size: 64 pages
[  108.010274] HugeTLB registered 4 MB page size, pre-allocated 0 pages
[  108.013581] VFS: Disk quotas dquot_6.5.2
[  108.013668] Dquot-cache hash table entries: 1024 (order 0, 4096 bytes)
[  108.014670] fuse init (API version 7.16)
[  108.014786] msgmni has been set to 1639
[  108.015583] Block layer SCSI generic (bsg) driver version 0.4 loaded (major 253)
[  108.015689] io scheduler noop registered
[  108.015692] io scheduler deadline registered
[  108.015717] io scheduler cfq registered (default)
[  108.015817] pci_hotplug: PCI Hot Plug PCI Core version: 0.5
[  108.015841] pciehp: PCI Express Hot Plug Controller Driver version: 0.4
[  108.015955] ACPI: Deprecated procfs I/F for AC is loaded, please retry with CONFIG_ACPI_PROCFS_POWER cleared
[  108.016027] ACPI: AC Adapter [AC] (on-line)
[  108.016164] input: Power Button as /devices/LNXSYSTM:00/LNXPWRBN:00/input/input0
[  108.016169] ACPI: Power Button [PWRF]
[  108.016263] input: Sleep Button as /devices/LNXSYSTM:00/LNXSLPBN:00/input/input1
[  108.016268] ACPI: Sleep Button [SLPF]
[  108.016543] ACPI: acpi_idle registered with cpuidle
[  108.018238] ERST: Table is not found!
[  108.018417] Serial: 8250/16550 driver, 32 ports, IRQ sharing enabled
[  108.018781] isapnp: Scanning for PnP cards...
[  108.152214] Freeing initrd memory: 12508k freed
[  108.382837] isapnp: No Plug & Play device found
[  111.244633] Linux agpgart interface v0.103
[  111.249042] brd: module loaded
[  111.251100] loop: module loaded
[  111.251322] i2c-core: driver [adp5520] using legacy suspend method
[  111.251330] i2c-core: driver [adp5520] using legacy resume method
[  111.251536] ata_piix 0000:00:01.1: version 2.13
[  111.253436] scsi0 : ata_piix
[  111.254020] scsi1 : ata_piix
[  111.254166] ata1: PATA max UDMA/33 cmd 0x1f0 ctl 0x3f6 bmdma 0xd000 irq 14
[  111.254176] ata2: PATA max UDMA/33 cmd 0x170 ctl 0x376 bmdma 0xd008 irq 15
[  111.255376] Fixed MDIO Bus: probed
[  111.255492] PPP generic driver version 2.4.2
[  111.255595] tun: Universal TUN/TAP device driver, 1.6
[  111.255602] tun: (C) 1999-2004 Max Krasnyansky <maxk@qualcomm.com>
[  111.255880] ehci_hcd: USB 2.0 'Enhanced' Host Controller (EHCI) Driver
[  111.255925] ohci_hcd: USB 1.1 'Open' Host Controller (OHCI) Driver
[  111.256122] ohci_hcd 0000:00:06.0: PCI INT A -> GSI 22 (level, low) -> IRQ 22
[  111.256233] ohci_hcd 0000:00:06.0: OHCI Host Controller
[  111.256338] ohci_hcd 0000:00:06.0: new USB bus registered, assigned bus number 1
[  111.256560] ohci_hcd 0000:00:06.0: irq 22, io mem 0xf0804000
[  111.693064] ata2.00: ATAPI: VBOX CD-ROM, 1.0, max UDMA/133
[  111.693165] hub 1-0:1.0: USB hub found
[  111.693187] hub 1-0:1.0: 12 ports detected
[  111.693520] ata2.00: configured for UDMA/33
[  111.693553] uhci_hcd: USB Universal Host Controller Interface driver
[  111.693633] i8042: PNP: PS/2 Controller [PNP0303:PS2K,PNP0f03:PS2M] at 0x60,0x64 irq 1,12
[  111.694182] scsi 1:0:0:0: CD-ROM            VBOX     CD-ROM           1.0  PQ: 0 ANSI: 5
[  111.694959] serio: i8042 KBD port at 0x60,0x64 irq 1
[  111.694980] serio: i8042 AUX port at 0x60,0x64 irq 12
[  111.695196] mousedev: PS/2 mouse device common for all mice
[  111.695206] sr0: scsi3-mmc drive: 32x/32x xa/form2 tray
[  111.695211] cdrom: Uniform CD-ROM driver Revision: 3.20
[  111.695410] sr 1:0:0:0: Attached scsi CD-ROM sr0
[  111.695529] sr 1:0:0:0: Attached scsi generic sg0 type 5
[  111.696212] input: AT Translated Set 2 keyboard as /devices/platform/i8042/serio0/input/input2
[  111.725053] rtc_cmos rtc_cmos: rtc core: registered rtc_cmos as rtc0
[  111.725154] rtc0: alarms up to one day, 114 bytes nvram
[  111.725297] device-mapper: uevent: version 1.0.3
[  111.725428] device-mapper: ioctl: 4.19.1-ioctl (2011-01-07) initialised: dm-devel@redhat.com
[  111.725917] device-mapper: multipath: version 1.2.0 loaded
[  111.725923] device-mapper: multipath round-robin: version 1.0.0 loaded
[  111.726048] EISA: Probing bus 0 at eisa.0
[  111.726076] Cannot allocate resource for EISA slot 4
[  111.726102] EISA: Detected 0 cards.
[  111.726458] cpuidle: using governor ladder
[  111.726462] cpuidle: using governor menu
[  111.726941] TCP cubic registered
[  111.727178] NET: Registered protocol family 10
[  111.728167] NET: Registered protocol family 17
[  111.728186] Registering the dns_resolver key type
[  111.728381] Using IPI No-Shortcut mode
[  111.728505] PM: Hibernation image not present or could not be loaded.
[  111.728516] registered taskstats version 1
[  111.729007]   Magic number: 15:191:149
[  111.729019] bdi 1:1: hash matches
[  111.729179] rtc_cmos rtc_cmos: setting system clock to 2019-04-24 22:07:39 UTC (1556143659)
[  111.729184] BIOS EDD facility v0.16 2004-Jun-25, 0 devices found
[  111.729188] EDD information not available.
[  111.729400] Freeing unused kernel memory: 700k freed
[  111.729606] Write protecting the kernel text: 5192k
[  111.729780] Write protecting the kernel read-only data: 2148k
[  111.759007] <30>udev[76]: starting version 167
[  111.805835] e1000: Intel(R) PRO/1000 Network Driver - version 7.3.21-k8-NAPI
[  111.805839] e1000: Copyright (c) 1999-2006 Intel Corporation.
[  111.805908] e1000 0000:00:03.0: PCI INT A -> GSI 19 (level, low) -> IRQ 19
[  112.100086] usb 1-1: new full speed USB device using ohci_hcd and address 2
[  112.215596] e1000 0000:00:03.0: eth0: (PCI:33MHz:32-bit) 08:00:27:ba:8b:2f
[  112.215604] e1000 0000:00:03.0: eth0: Intel(R) PRO/1000 Network Connection
[  112.215669] ahci 0000:00:0d.0: version 3.0
[  112.215742] ahci 0000:00:0d.0: PCI INT A -> GSI 21 (level, low) -> IRQ 21
[  112.215903] ahci: SSS flag set, parallel bus scan disabled
[  112.216160] ahci 0000:00:0d.0: AHCI 0001.0100 32 slots 1 ports 3 Gbps 0x1 impl SATA mode
[  112.216167] ahci 0000:00:0d.0: flags: 64bit ncq stag only ccc 
[  112.216915] scsi2 : ahci
[  112.217060] ata3: SATA max UDMA/133 abar m8192@0xf0806000 port 0xf0806100 irq 21
[  112.545370] ata3: SATA link up 3.0 Gbps (SStatus 123 SControl 300)
[  112.545543] ata3.00: ATA-6: VBOX HARDDISK, 1.0, max UDMA/133
[  112.545547] ata3.00: 20971520 sectors, multi 128: LBA48 NCQ (depth 31/32)
[  112.545770] ata3.00: configured for UDMA/133
[  112.545918] scsi 2:0:0:0: Direct-Access     ATA      VBOX HARDDISK    1.0  PQ: 0 ANSI: 5
[  112.546111] sd 2:0:0:0: [sda] 20971520 512-byte logical blocks: (10.7 GB/10.0 GiB)
[  112.546136] sd 2:0:0:0: Attached scsi generic sg1 type 0
[  112.546184] sd 2:0:0:0: [sda] Write Protect is off
[  112.546189] sd 2:0:0:0: [sda] Mode Sense: 00 3a 00 00
[  112.546215] sd 2:0:0:0: [sda] Write cache: enabled, read cache: enabled, doesn't support DPO or FUA
[  112.547004]  sda: sda1 sda2 < sda5 >
[  112.547341] sd 2:0:0:0: [sda] Attached SCSI disk
[  112.585442] EXT4-fs (sda1): INFO: recovery required on readonly filesystem
[  112.585446] EXT4-fs (sda1): write access will be enabled during recovery
[  112.593222] input: VirtualBox USB Tablet as /devices/pci0000:00/0000:00:06.0/usb1/1-1/1-1:1.0/input/input3
[  112.593402] generic-usb 0003:80EE:0021.0001: input,hidraw0: USB HID v1.10 Mouse [VirtualBox USB Tablet] on usb-0000:00:06.0-1/input0
[  112.593628] usbcore: registered new interface driver usbhid
[  112.593631] usbhid: USB HID core driver
[  112.669354] EXT4-fs (sda1): recovery complete
[  112.669979] EXT4-fs (sda1): mounted filesystem with ordered data mode. Opts: (null)
[  113.245362] Adding 4191228k swap on /dev/sda5.  Priority:-1 extents:1 across:4191228k 
[  113.254486] EXT4-fs (sda1): re-mounted. Opts: errors=remount-ro
[  113.276482] <30>udev[291]: starting version 167
[  113.322728] lp: driver loaded but no devices found
[  113.329875] type=1400 audit(1556143661.096:2): apparmor="STATUS" operation="profile_load" name="/sbin/dhclient" pid=340 comm="apparmor_parser"
[  113.330427] type=1400 audit(1556143661.096:3): apparmor="STATUS" operation="profile_load" name="/usr/lib/NetworkManager/nm-dhcp-client.action" pid=340 comm="apparmor_parser"
[  113.330759] type=1400 audit(1556143661.096:4): apparmor="STATUS" operation="profile_load" name="/usr/lib/connman/scripts/dhclient-script" pid=340 comm="apparmor_parser"
[  113.402819] piix4_smbus 0000:00:07.0: SMBus Host Controller at 0x4100, revision 0
[  113.443916] ADDRCONF(NETDEV_UP): eth0: link is not ready
[  113.481558] vboxguest 0000:00:04.0: PCI INT A -> GSI 20 (level, low) -> IRQ 20
[  113.482680] vgdrvHeartbeatInit: Setting up heartbeat to trigger every 2000 milliseconds
[  113.482784] input: Unspecified device as /devices/pci0000:00/0000:00:04.0/input/input4
[  113.482964] vboxguest: misc device minor 56, IRQ 20, I/O port d020, MMIO at 00000000f0400000 (size 0x400000)
[  113.482967] vboxguest: Successfully loaded version 5.2.22 (interface 0x00010004)
[  113.517930] type=1400 audit(1556143661.284:5): apparmor="STATUS" operation="profile_load" name="/usr/share/gdm/guest-session/Xsession" pid=601 comm="apparmor_parser"
[  113.520355] type=1400 audit(1556143661.284:6): apparmor="STATUS" operation="profile_load" name="/usr/lib/cups/backend/cups-pdf" pid=605 comm="apparmor_parser"
[  113.521357] type=1400 audit(1556143661.288:7): apparmor="STATUS" operation="profile_load" name="/usr/sbin/cupsd" pid=605 comm="apparmor_parser"
[  113.523868] type=1400 audit(1556143661.288:8): apparmor="STATUS" operation="profile_replace" name="/sbin/dhclient" pid=602 comm="apparmor_parser"
[  113.523958] type=1400 audit(1556143661.288:9): apparmor="STATUS" operation="profile_load" name="/usr/sbin/tcpdump" pid=606 comm="apparmor_parser"
[  113.524661] type=1400 audit(1556143661.292:10): apparmor="STATUS" operation="profile_replace" name="/usr/lib/NetworkManager/nm-dhcp-client.action" pid=602 comm="apparmor_parser"
[  113.525382] type=1400 audit(1556143661.292:11): apparmor="STATUS" operation="profile_replace" name="/usr/lib/connman/scripts/dhclient-script" pid=602 comm="apparmor_parser"
[  113.565064] input: Video Bus as /devices/LNXSYSTM:00/device:00/PNP0A03:00/LNXVIDEO:00/input/input5
[  113.565163] ACPI: Video Device [GFX0] (multi-head: yes  rom: no  post: no)
[  113.571688] psmouse serio1: ID: 10 00 64
[  113.575924] input: ImExPS/2 Generic Explorer Mouse as /devices/platform/i8042/serio1/input/input6
[  113.701845] Intel ICH 0000:00:05.0: PCI INT A -> GSI 21 (level, low) -> IRQ 21
[  113.828894] vboxsf: Successfully loaded version 5.2.22 (interface 0x00010004)
[  113.996432] intel8x0: white list rate for 1028:0177 is 48000
[  114.047036] vesafb: framebuffer at 0xe0000000, mapped to 0xfb000000, using 1216k, total 1216k
[  114.047041] vesafb: mode is 640x480x32, linelength=2560, pages=0
[  114.047044] vesafb: scrolling: redraw
[  114.047048] vesafb: Truecolor: size=8:8:8:8, shift=24:16:8:0
[  114.047152] Console: switching to colour frame buffer device 80x30
[  114.047173] fb0: VESA VGA frame buffer device
[  114.053423] ppdev: user-space parallel port driver
[  114.216504] e1000: eth0 NIC Link is Up 1000 Mbps Full Duplex, Flow Control: RX
[  114.217195] ADDRCONF(NETDEV_CHANGE): eth0: link becomes ready
[  114.292378] EXT4-fs (sda1): re-mounted. Opts: errors=remount-ro,commit=0
[  114.386055] VBoxService 5.2.22 r126460 (verbosity: 0) linux.x86 (Nov  8 2018 20:51:07) release log
[  114.386057] 00:00:00.000160 main     Log opened 2019-04-24T22:07:42.156914000Z
[  114.386103] 00:00:00.000226 main     OS Product: Linux
[  114.386166] 00:00:00.000258 main     OS Release: 2.6.38-8-generic
[  114.386198] 00:00:00.000322 main     OS Version: #42-Ubuntu SMP Mon Apr 11 03:31:50 UTC 2011
[  114.386244] 00:00:00.000356 main     Executable: /opt/VBoxGuestAdditions-5.2.22/sbin/VBoxService
[  114.386247] 00:00:00.000358 main     Process ID: 1075
[  114.386248] 00:00:00.000360 main     Package type: LINUX_32BITS_GENERIC
[  114.387467] 00:00:00.001591 main     5.2.22 r126460 started. Verbose level = 0
[  116.342587] EXT4-fs (sda1): re-mounted. Opts: errors=remount-ro,commit=0
[  116.719161] ISO 9660 Extensions: Microsoft Joliet Level 3
[  116.779290] ISO 9660 Extensions: RRIP_1991A
[  124.628129] eth0: no IPv6 routers present
[ 6106.951994] e1000: eth0 NIC Link is Down
[ 6109.938565] e1000: eth0 NIC Link is Up 1000 Mbps Full Duplex, Flow Control: RX
[ 6112.258900] e1000: eth0 NIC Link is Down
[ 6115.256387] e1000: eth0 NIC Link is Up 1000 Mbps Full Duplex, Flow Control: RX
[ 6179.559536] e1000: eth0 NIC Link is Down
[ 6182.564841] e1000: eth0 NIC Link is Up 1000 Mbps Full Duplex, Flow Control: RX
[ 6280.792191] module loaded
[ 6303.542628] module unloaded
[ 6310.814280] e1000: eth0 NIC Link is Down
[ 6313.823077] e1000: eth0 NIC Link is Up 1000 Mbps Full Duplex, Flow Control: RX
[ 6386.603580] module loaded
[ 6453.478506] module unloaded
[ 6755.470431] module loaded
[ 7109.250988] module unloaded
[ 7188.871717] module loaded
[ 7242.655418] module unloaded
[ 7375.923841] module loaded
[ 7409.187911] module unloaded
[ 8462.913040] module loaded
[ 8468.416319] sys_kill -- ssh-agent pid -85323680 sig 224
[ 8475.095022] sys_kill -- bash pid -85323680 sig 224
[ 8485.698917] sys_kill -- bash pid -85323680 sig 224
[ 8487.442889] sys_kill -- bash pid -85323680 sig 224
[ 8534.986591] sys_kill -- bash pid -85323680 sig 224
[ 8557.935249] sys_kill -- bash pid -85323680 sig 224
[ 8562.194453] sys_kill -- bash pid -85323680 sig 224
[ 8577.804686] sys_kill -- kill pid -85323680 sig 224
[ 8596.631020] sys_kill -- kill pid -85323680 sig 224
[ 8617.955107] sys_kill -- kill pid -85323680 sig 224
[ 8620.019240] sys_kill -- kill pid -85323680 sig 224
[ 8627.283433] sys_kill -- kill pid -85323680 sig 224
[ 8628.828234] sys_kill -- kill pid -85323680 sig 224
[ 8630.298435] sys_kill -- kill pid -85323680 sig 224
[ 8691.015618] sys_kill -- gnome-terminal pid -85323680 sig 224
[ 8691.015623] sys_kill -- gnome-terminal pid -85323680 sig 224
[ 8691.015888] sys_kill -- bash pid -85323680 sig 224
[ 8693.856217] sys_kill -- gnome-terminal pid -85323680 sig 224
[ 8693.856223] sys_kill -- gnome-terminal pid -85323680 sig 224
[ 8693.856592] sys_kill -- bash pid -85323680 sig 224
[ 8693.856609] sys_kill -- bash pid -85323680 sig 224
[ 8705.585757] module unloaded
[ 9134.823897] module loaded
[ 9147.755100] System call getpriority hooked
[ 9147.755147] System call getpriority hooked
fedor@fedor-VirtualBox:~/STUDY/khook-master$ ls -l
total 60
-rw-r--r-- 1 fedor fedor    8 2019-04-25 04:37 built-in.o
-rw-r--r-- 1 fedor fedor  278 2019-04-25 04:07 Kbuild
drwxr-xr-x 3 fedor fedor 4096 2019-04-15 13:26 khook
-rw-r--r-- 1 fedor fedor 6329 2019-04-25 04:37 khook.ko
-rw-r--r-- 1 fedor fedor 1109 2019-04-25 04:37 khook.mod.c
-rw-r--r-- 1 fedor fedor 2692 2019-04-25 04:37 khook.mod.o
-rw-r--r-- 1 fedor fedor 4242 2019-04-25 04:37 khook.o
-rw-r--r-- 1 fedor fedor  999 2019-04-25 04:37 main.c
-rw-r--r-- 1 fedor fedor 4324 2019-04-25 04:37 main.o
-rw-r--r-- 1 fedor fedor  132 2019-04-15 13:26 Makefile
-rw-r--r-- 1 fedor fedor   47 2019-04-25 04:37 modules.order
-rw-r--r-- 1 fedor fedor    0 2019-04-25 04:37 Module.symvers
-rw-r--r-- 1 fedor fedor 3227 2019-04-15 13:26 README.md
fedor@fedor-VirtualBox:~/STUDY/khook-master$ sudo rmmod khook 
fedor@fedor-VirtualBox:~/STUDY/khook-master$ make clean
make -C /lib/modules/2.6.38-8-generic/build M=$PWD clean
make[1]: Entering directory `/usr/src/linux-headers-2.6.38-8-generic'
  CLEAN   /home/fedor/STUDY/khook-master/.tmp_versions
  CLEAN   /home/fedor/STUDY/khook-master/Module.symvers
make[1]: Leaving directory `/usr/src/linux-headers-2.6.38-8-generic'
fedor@fedor-VirtualBox:~/STUDY/khook-master$ gedit main.c 
fedor@fedor-VirtualBox:~/STUDY/khook-master$ make
make -C /lib/modules/2.6.38-8-generic/build M=$PWD
make[1]: Entering directory `/usr/src/linux-headers-2.6.38-8-generic'
  LD      /home/fedor/STUDY/khook-master/built-in.o
  CC [M]  /home/fedor/STUDY/khook-master/main.o
  LD [M]  /home/fedor/STUDY/khook-master/khook.o
  Building modules, stage 2.
  MODPOST 1 modules
  CC      /home/fedor/STUDY/khook-master/khook.mod.o
  LD [M]  /home/fedor/STUDY/khook-master/khook.ko
make[1]: Leaving directory `/usr/src/linux-headers-2.6.38-8-generic'
fedor@fedor-VirtualBox:~/STUDY/khook-master$ sudo insmod khook.ko
fedor@fedor-VirtualBox:~/STUDY/khook-master$ ../prior/./test 
priority before change :-1
changed priority to :-1
fedor@fedor-VirtualBox:~/STUDY/khook-master$ tail /var/log/kern.log 
Apr 25 04:30:51 fedor-VirtualBox kernel: [ 8705.585757] module unloaded
Apr 25 04:38:00 fedor-VirtualBox kernel: [ 9134.823897] module loaded
Apr 25 04:38:13 fedor-VirtualBox kernel: [ 9147.755100] System call getpriority hooked
Apr 25 04:38:13 fedor-VirtualBox kernel: [ 9147.755147] System call getpriority hooked
Apr 25 04:38:47 fedor-VirtualBox kernel: [ 9181.940073] System call getpriority hooked
Apr 25 04:38:47 fedor-VirtualBox kernel: [ 9181.941211] module unloaded
Apr 25 04:40:29 fedor-VirtualBox kernel: [ 9283.793204] module loaded
Apr 25 04:40:35 fedor-VirtualBox kernel: [ 9290.099752] System call getpriority hooked
Apr 25 04:40:35 fedor-VirtualBox kernel: [ 9290.099795] System call setpriority hooked
Apr 25 04:40:35 fedor-VirtualBox kernel: [ 9290.099800] System call getpriority hooked
fedor@fedor-VirtualBox:~/STUDY/khook-master$ gedit main.c 

